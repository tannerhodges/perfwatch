<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
		<!-- https://alpinejs.dev/advanced/csp -->
		<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'">
		<meta http-equiv="X-Content-Security-Policy" content="default-src 'self'; script-src 'self'">

		<title>⏱️ perfwatch</title>

		<link rel="stylesheet" href="./style.css">

		<script defer src="./renderer.js"></script>
		<script defer src="./vendor/chartjs-4.4.0.umd.js"></script>
		<script defer src="./vendor/alpinejs-persist-3.10.2.min.js"></script>
		<script defer src="./vendor/alpinejs-csp-3.13.0-5-gd77d117.min.js"></script>
	</head>
	<body x-data="App">
		<h1>⏱️ perfwatch</h1>

		<h2>Add script to your website</h2>
		<pre><code>&lt;!-- ⏱️ perfwatch - ONLY FOR LOCAL DEVELOPMENT --&gt;
&lt;script async src="http://localhost:1873/perfwatch.js"&gt;&lt;/script&gt;</code></pre>

		<h2>Select your project folder</h2>
		<div>
			<button type="button" @click="selectFolder">Select Folder</button>
			<strong x-text="folderPath"></strong>
		</div>

		<h2>Load your website</h2>
		<p>Then check back here to see the results…</p>

		<div>
			<!-- TODO: Fix x-model failing to update selectedMetric -->
			<label for="selectedMetric">Filter by metric:</label>
			<select id="selectedMetric" x-model="selectedMetric">
				<option value="">View All</option>
				<option>TTFB</option>
				<option>FCP</option>
				<option>LCP</option>
				<option>FID</option>
				<option>CLS</option>
			</select>
			<button type="button" @click="reset">Reset</button>

			<hr>

			<canvas x-ref="canvas" class="rounded-lg bg-white p-8"></canvas>

			<hr>

			<details>
				<summary>Show All Events</summary>
				<table cellpadding="5" border="1">
					<thead>
						<th>Metric</th>
						<th>Value</th>
					</thead>
					<tbody>
						<template x-for="event in events">
							<tr x-show="!selectedMetric || selectedMetric === event.name">
								<td x-text="event.name"></td>
								<td x-text="event.value.toFixed(3)"></td>
							</tr>
						</template>
					</tbody>
					<tfoot>
						<template x-for="metric in ['TTFB', 'FCP', 'LCP', 'FID', 'CLS']">
							<tr x-show="!selectedMetric || selectedMetric === metric">
								<td x-text="`Average ${metric}`"></td>
								<td x-text="getAverage(events.filter(e => e.name === metric)).toFixed(3)"></td>
							</tr>
						</template>
					</tfoot>
				</table>
			</details>

			<details>
				<summary>Show File Changes</summary>
				<table cellpadding="5" border="1">
					<thead>
						<th>Timestamp</th>
						<th>Event</th>
						<th>Path</th>
					</thead>
					<tbody>
						<!-- TODO: Fix object properties failing to render -->
						<template x-for="fileChange in fileChanges">
							<tr>
								<td x-text="formatDateTime(fileChange.timestamp)"></td>
								<td x-text="fileChange.event"></td>
								<td x-text="fileChange.path"></td>
							</tr>
						</template>
					</tbody>
				</table>
			</details>
		</div>
	</body>
</html>
